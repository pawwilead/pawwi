<div class="main-container">
  <h1>Gesti√≥n de Usuarios</h1>

  <!-- Tabs -->
  <div class="tabs">
    <button 
      class="tab" 
      [class.active]="filtroTipo === 'cliente'" 
      (click)="filtroTipo = 'cliente'">
      Clientes
    </button>
    <button 
      class="tab" 
      [class.active]="filtroTipo === 'pawwer'" 
      (click)="filtroTipo = 'pawwer'">
      Pawwers
    </button>
  </div>

  <!-- Filtros -->
  <div class="filters">
    <label>
      Buscar por:
      <select [(ngModel)]="criterioBusqueda">
        <option value="_id">ID</option>
        <option value="celular">Celular</option>
        <option value="nombre">Nombre</option>
      </select>
    </label>

    <input 
      type="text" 
      [(ngModel)]="textoBusqueda" 
      placeholder="üîç Buscar..." />
  </div>

  <!-- Grid de usuarios -->
  <div class="usuarios-grid">
    <div 
      class="usuario-card" 
      *ngFor="let u of usuariosFiltrados; trackBy: trackById">
      
      <!-- Header de la tarjeta -->
      <div class="card-header" (click)="abrirUsuario(u._id)">
        <div>
          <h2>{{ u.nombre }}</h2>
          <small>üì± {{ u.celular }}</small>
        </div>
        <button class="toggle-btn">
          {{ toggleUsuarioOpen === u._id ? '‚ñ≤' : '‚ñº' }}
        </button>
      </div>

      <!-- Cuerpo de la tarjeta -->
      <div class="card-body" *ngIf="toggleUsuarioOpen === u._id">
        <div class="info">
          <p><strong>ID:</strong> {{ u._id }}</p>
          <p><strong>Tipo:</strong> {{ u.tipoUsuario }}</p>
          <p><strong>Direcci√≥n:</strong> {{ u.direccion || 'No definida' }}</p>
          <p><strong>Registro Web:</strong> {{ u.RegistroWeb }}</p>
          <p><strong>Agendamientos:</strong> {{ u.agendamientos }}</p>
          <small class="fecha">
            üóìÔ∏è Registrado: {{ u.creadoEn | date:'mediumDate' }}
          </small>
        </div>

        <!-- Lista de perros -->
        <div class="perros">
          <h4 (click)="abrirPerros(u._id)">
            üê∂ Perros ({{ u.perros.length }})
            <span>
              {{ togglePerrosOpen === u._id ? '‚ñ≤' : '‚ñº' }}
            </span>
          </h4>
          <div *ngIf="togglePerrosOpen === u._id">
            <div class="perro-card" *ngFor="let perro of u.perros">
              <p><strong>Nombre:</strong> {{ perro.nombre }}</p>
              <p><strong>Raza:</strong> {{ perro.raza }}</p>
              <p><strong>Tama√±o:</strong> {{ perro.tamano }}</p>
              <p><strong>Edad:</strong> {{ perro.edad }}</p>
              <p><strong>Vacunas:</strong> {{ perro.vacunas ? 'S√≠' : 'No' }}</p>
              <p><strong>Obs:</strong> {{ perro.observaciones }}</p>
            </div>
          </div>
        </div>
        <!-- Editor de tipo de usuario -->
        <div class="editar-tipo">
          <label for="tipoSelect-{{u._id}}">Cambiar tipo:</label>
          <select id="tipoSelect-{{u._id}}" [(ngModel)]="u.nuevoTipo">
            <option value="cliente">Cliente</option>
            <option value="pawwer">Pawwer</option>
          </select>
          <button class="btn-actualizar" (click)="actualizarTipo(u)">
            Actualizar
          </button>
        </div>

      </div>
    </div>
  </div>
</div>
