<app-navbar></app-navbar>
<div class="modal" *ngIf="abrirFormulario">
  <div class="modal-content">
    <button class="btn-close" (click)="abrirFormulario = false">‚úñ</button>
    <h2>‚ûï Agregar nuevo paseo</h2>
    <div class="form-agregar">

      <!-- Cliente -->
      <label>
        Cliente:
        <button type="button" class="btn btn-pawwer" (click)="abrirPopupCliente()">
          {{ nuevoPaseo.nombre ? nuevoPaseo.nombre + ' - ' + nuevoPaseo.celular : 'Seleccionar Cliente' }}
        </button>
      </label>


      <!-- Direcci√≥n -->
      <label>
        Direcci√≥n:
        <input type="text" [(ngModel)]="nuevoPaseo.direccion" placeholder="Ingrese direcci√≥n" />
      </label>

      <!-- Perro -->
      <label>
        Perro:
        <select [(ngModel)]="nuevoPaseo.perro" 
                [disabled]="perrosCliente.length === 0"
                (change)="seleccionarPerro(nuevoPaseo.perro)">
          <option value="">-- Seleccione Perro --</option>
          <option *ngFor="let p of perrosCliente" [value]="p.nombre">{{ p.nombre }}</option>
        </select>
      </label>

      <!-- Tipo de servicio -->
      <label>
        Tipo de Servicio:
        <input type="text" [(ngModel)]="nuevoPaseo.tipoServicio" readonly />
      </label>

      <!-- Tiempo de servicio -->
      <label>
        Tiempo de Servicio:
        <select [(ngModel)]="nuevoPaseo.tiempoServicio">
          <option *ngFor="let t of tiemposServicio" [value]="t">{{ t }}</option>
        </select>
      </label>

      <!-- Fecha y hora -->
      <label>
        Fecha:
        <input type="date" [(ngModel)]="nuevoPaseo.fecha" />
      </label>
      <label>
        Hora:
        <input type="time" [(ngModel)]="nuevoPaseo.hora" />
      </label>

      <!-- Precio -->
      <label>
        Precio:
        <input type="number" [(ngModel)]="nuevoPaseo.precio" />
      </label>

      <!-- M√©todo de pago -->
      <label>
        M√©todo de Pago:
        <select [(ngModel)]="nuevoPaseo.metodoPago">
          <option *ngFor="let m of metodosPago" [value]="m">{{ m }}</option>
        </select>
      </label>

      <!-- Anotaciones -->
      <label>
        Anotaciones:
        <input type="text" [(ngModel)]="nuevoPaseo.anotaciones" />
      </label>

      <button (click)="agregarPaseo(); abrirFormulario = false" class="btn btn-add">Agregar Paseo</button>
    </div>
  </div>
</div>


<div class="paseos-container">
  <h1>Paseos por Agendar</h1>
  <button class="btn btn-add" (click)="abrirFormulario = true">‚ûï Agregar Paseo</button>

  <!-- üîò Botones de estados -->
  <div class="tabs">
    <button 
      class="tab" 
      [class.active]="filtroEstado === ''"
      (click)="filtroEstado = ''">
      Todos
    </button>
    <button 
      class="tab" 
      *ngFor="let e of estados" 
      [class.active]="filtroEstado === e"
      (click)="filtroEstado = e">
      {{ e }}
    </button>
  </div>

  <!-- üîé Filtros -->
  <div class="filters">
    <label>
      Buscar por:
      <select [(ngModel)]="criterioBusqueda">
        <option value="nombre">Nombre</option>
        <option value="celular">Celular</option>
        <option value="direccion">Direcci√≥n</option>
        <option value="estado">Estado</option>
      </select>
    </label>

    <input
      type="text"
      [(ngModel)]="textoBusqueda"
      placeholder="üîç Buscar..."
    />
  </div>

  

  <!-- Grid de paseos -->
  <div *ngFor="let paseo of paseosFiltrados; trackBy: trackById" class="paseo-card">
    <!-- Header -->
    <div class="header" (click)="abrirPaseo(paseo._id)">
      <div>
        <h2>{{ paseo.nombre }} - {{ paseo.perro }}</h2>
        <p class="subinfo">üìû {{ paseo.celular }}</p>
        <p class="subinfo">üìç {{ paseo.direccion }}</p>
        <button (click)="copiarMensaje(paseo)" class="btn btn-copy">Copiar mensaje de grupos</button>
      </div>
      <span class="estado" [ngClass]="{
    'paseo-cancelado': paseo.estado === 'Cancelado',
    'paseo-pendiente': paseo.estado === 'Pendiente',
    'paseo-oms': paseo.estado === 'Pendiente desde OMS',
    'paseo-confirmar': paseo.estado === 'confirmar',
    'paseo-cambiar': paseo.estado === 'Cambiar'
  }">{{ paseo.estado }}</span>
    </div>

    <!-- Body (toggle) -->
    <div *ngIf="toggleOpen === paseo._id" class="body">
      <p><strong>Servicio:</strong> {{ paseo.tipoServicio }} - {{ paseo.tiempoServicio }}</p>
      <p><strong>Fecha:</strong> {{ paseo.fecha }}</p>
      <p><strong>Hora:</strong> {{ paseo.hora }}</p>
      <p><strong>Precio:</strong> {{ paseo.precio | currency:'USD' }}</p>
      <p><strong>M√©todo de pago:</strong> {{ paseo.metodoPago }}</p>
      <p><strong>Creado:</strong> {{ paseo.fechaCreacion | date:'short' }}</p>

      <div class="anotaciones">
        {{ paseo.anotaciones }}
      </div>

      <!-- Editor -->
      <div class="editor">
        <label>
          Fecha (DD/MM)
          <input class="input-a" type="date" [(ngModel)]="paseo.nuevaFecha" />
        </label>

        <label>
          Hora (24h)
          <input class="input-a"  type="time" [(ngModel)]="paseo.nuevaHora" />
        </label>

        <label>
          Precio:
          <input class="input-a"  type="number" [(ngModel)]="paseo.nuevoPrecio" />
        </label>

        <label>
          M√©todo de pago:
          <select [(ngModel)]="paseo.nuevoMetodoPago">
            <option *ngFor="let m of metodosPago" [value]="m">{{ m }}</option>
          </select>
        </label>

        <label>
          Estado
          <select [(ngModel)]="paseo.nuevoEstado">
            <option *ngFor="let e of estados" [value]="e">{{ e }}</option>
          </select>
        </label>

        <label>
        Pawwer asignado:

        <div class="pawwer-select">
          <button class="btn btn-pawwer" (click)="abrirPopupPawwer(paseo)">
            üêæ Seleccionar Pawwer
          </button>

          <span *ngIf="paseo.nuevoPawwer">
            üêæ {{ paseo.nuevoPawwer }}
          </span>
        </div>
      </label>

        <button (click)="actualizarPaseo(paseo)" class="btn btn-save">
          Guardar Cambios
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="paseosFiltrados.length === 0" class="empty">
    <h3>No hay paseos que coincidan con la b√∫squeda</h3>
  </div>
</div>
<!-- POPUP PARA SELECCIONAR PAWWER -->
<div class="modal" *ngIf="popupPawwerVisible">
  <div class="modal-content pawwer-popup">
    <button class="btn btn-close" (click)="popupPawwerVisible = false">
      ‚úñ
    </button>

    <h2>üêæ Seleccionar Pawwer</h2>
    <input 
      type="text" 
      [(ngModel)]="busquedaPawwer"
      placeholder="üîç Buscar por nombre o n√∫mero"
      class="input-search"
    />

    <div class="pawwer-list">
      <div 
        *ngFor="let p of pawwersFiltrados()" 
        class="pawwer-item"
        (click)="seleccionarPawwer(p)"
      >
      <strong>{{ p.nombre }}</strong>
      <p class="celular-pawwer">{{ p.celular }}</p>
      </div>

      <div *ngIf="pawwersFiltrados().length === 0" class="empty">
        No hay resultados
      </div>
    </div>

  </div>
</div>

<div class="modal" *ngIf="popupClienteVisible">
  <div class="modal-content pawwer-popup">
    <button class="btn btn-close" (click)="popupClienteVisible = false">‚úñ</button>

    <h2>üë§ Seleccionar Cliente</h2>
    <input 
      type="text" 
      [(ngModel)]="busquedaCliente"
      placeholder="üîç Buscar por nombre o celular"
      class="input-search"
    />

    <div class="pawwer-list">
      <div 
        *ngFor="let c of clientesFiltrados()" 
        class="pawwer-item"
        (click)="seleccionarClientePopup(c)"
      >
        <strong>{{ c.nombre }}</strong>
        <p class="celular-pawwer">{{ c.celular }}</p>
      </div>

      <div *ngIf="clientesFiltrados().length === 0" class="empty">
        No hay resultados
      </div>
    </div>

  </div>
</div>
