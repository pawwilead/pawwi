<app-navbar></app-navbar>
<div class="paseos-container">
  <h1>Paseos en Curso</h1>

  <!-- Barra de filtros -->

    <div class="tabs">
    <button
        class="tab"
        [class.active]="filtroEstado === ''"
        (click)="limpiarFiltro()">
        Todos
    </button>

    <button
        *ngFor="let estado of estados"
        class="tab"
        [class.active]="estado === filtroEstado"
        (click)="filtrarPorEstado(estado)">
        {{ estado }}
    </button>
    </div>


  <div *ngFor="let paseo of paseosFiltrados; trackBy: trackById" class="paseo-card">
    <!-- Header -->
    <div class="header" (click)="abrirPaseo(paseo._id)">
      <div>
        <h2>{{ paseo.Nombre }} - üê∂ {{ paseo.Perro }}</h2>
        <p class="subinfo">üìû Cliente: {{ paseo.Celular }}</p>
        <p class="subinfo">üìç {{ paseo.Direccion }}</p>
        
      </div>
      <span class="estado">{{ paseo.Estado }}</span>
    </div>

    <!-- Body (toggle) -->
    <div *ngIf="toggleOpen === paseo._id" class="body">
      <p><strong>Celular Pawwer:</strong> {{ paseo.CelularPawwer }}</p>
      <p><strong>Pawwer:</strong> {{ paseo.NombrePawwer }}</p>
      <p><strong>Servicio:</strong> {{ paseo.TipoServicio }} - {{ paseo.TiempoServicio }} min</p>
      <p><strong>Fecha:</strong> {{ paseo.Fecha }}</p>
      <p><strong>Hora:</strong> {{ paseo.Hora }}</p>
      <p><strong>Hora Inicio:</strong> {{ paseo.HoraInicio || 'No iniciada' }}</p>
      <p><strong>Precio:</strong> {{ paseo.Precio | currency:'USD' }}</p>
      <p><strong>M√©todo de pago:</strong> {{ paseo.MetodoPago }}</p>
      <p><strong>Creado:</strong> {{ paseo.FechaCreacion | date:'short' }}</p>
      <p><strong>Anotaciones:</strong> {{ paseo.Anotaciones }}</p>
      <p>
        <strong>Strava:</strong>
        <a *ngIf="paseo.Strava; else noStrava"
          [href]="'https://www.strava.com/beacon/' + paseo.Strava"
          target="_blank"
          rel="noopener noreferrer">
          Ver link de Strava
        </a>
        <ng-template #noStrava>N/A</ng-template>
      </p>

      <!-- Editor -->
      <div class="editor">
        <label>
          Fecha (DD/MM)
          <input type="date" [(ngModel)]="paseo.nuevaFecha" />
        </label>

        <label>
          Hora (24h)
          <input type="time" [(ngModel)]="paseo.nuevaHora" />
        </label>

        <label>
          Hora Inicio
          <input 
            type="datetime-local" 
            [(ngModel)]="paseo.nuevaHoraInicio" 
          />
        </label>


        <label>
          Estado
          <select [(ngModel)]="paseo.nuevoEstado">
            <option *ngFor="let estado of estados" [value]="estado">
              {{ estado }}
            </option>
          </select>
        </label>

        <label>
          Pawwer
          <div class="pawwer-selector">
            <input type="text" [(ngModel)]="paseo.nuevoPawwer" readonly />
          </div>
        </label>
        <button (click)="abrirPopupPawwer(paseo)" class="btn btn-pawwer">Cambiar Pawwer</button>

        <p><strong>Nombre Pawwer:</strong> {{ paseo.NombrePawwer }}</p>
        <p><strong>Celular Pawwer:</strong> {{ paseo.CelularPawwer }}</p>


        <button (click)="actualizarPaseo(paseo)" class="btn btn-save">
          Guardar Cambios
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="paseosFiltrados.length === 0" class="empty">
    <h3>No hay paseos en curso</h3>
    <p>Cuando haya paseos activos, aparecer√°n aqu√≠.</p>
  </div>
</div>
<!-- POPUP PARA SELECCIONAR PAWWER -->
<div class="modal" *ngIf="popupPawwerVisible">
  <div class="modal-content pawwer-popup">

    <button class="close-popup" (click)="popupPawwerVisible = false">‚úñ</button>

    <h2 class="titulo-popup">üêæ Seleccionar Pawwer</h2>

    <input 
      type="text" 
      [(ngModel)]="busquedaPawwer"
      placeholder="üîç Buscar por nombre o n√∫mero"
      class="input-search-pawwer"
    />

    <div class="pawwer-list">
      <div 
        *ngFor="let p of pawwersFiltrados" 
        class="pawwer-item-card"
        (click)="seleccionarPawwer(p)"
      >
        <div class="pw-info">
          <strong>{{ p.nombre }}</strong>
          <small>{{ p.celular }}</small>
        </div>
        <span class="pw-icon">‚û°Ô∏è</span>
      </div>

      <div *ngIf="pawwersFiltrados.length === 0" class="empty">
        No hay resultados
      </div>
    </div>

  </div>
</div>

